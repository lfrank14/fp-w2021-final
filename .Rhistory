bb <- bb %>%
select(SEQN, PAQ677, PAQ678)
sum(is.na(PAQ677))
sum(is.na(bb$PAQ677))
df
bb <- df$data[[3]]
bb <- bb %>%
select(SEQN, PAQ677, PAQ678)
sum(is.na(bb$PAQ677))
bb <- df$data[[2]]
bb <- bb %>%
select(SEQN, PAQ677, PAQ678)
sum(is.na(bb$PAQ677))
bb <- df$data[[4]]
bb <- bb %>%
select(SEQN, PAQ677, PAQ678)
sum(is.na(bb$PAQ677))
bb <- df$data[[5]]
bb <- bb %>%
select(SEQN, PAQ677, PAQ678)
sum(is.na(bb$PAQ677))
bb <- bb %>%
select(SEQN, PAQ677, PAQ678) %>%
na.omit() %>%
pivot_longer(cols = c(PAQ677, PAQ678),
names_to = "exercise_type",
values_to = "num_days") %>%
ggplot(aes(x = num_days, y = exercise_type, color = exercise_type)) +
geom_density_ridges()
bb %>%
select(SEQN, PAQ677, PAQ678) %>%
na.omit() %>%
pivot_longer(cols = c(PAQ677, PAQ678),
names_to = "exercise_type",
values_to = "num_days") %>%
ggplot(aes(x = num_days, y = exercise_type, color = exercise_type)) +
geom_density_ridges()
bb <- df$data[[3]]
bb %>%
select(SEQN, PAQ677, PAQ678) %>%
na.omit() %>%
pivot_longer(cols = c(PAQ677, PAQ678),
names_to = "exercise_type",
values_to = "num_days") %>%
ggplot(aes(x = num_days, y = exercise_type, color = exercise_type)) +
geom_density_ridges()
rm(list = ls())
dpaths <- fs::dir_ls(here::here("data"),
recurse = TRUE,
regexp = "demographic.csv")
demos <- map_df(dpaths, rio::import, .id = "fname") %>%
mutate(year = str_extract(fname, pattern = "\\d{4}_\\d{4}")) %>%
select(year, everything(), -fname)
qpaths <- fs::dir_ls(here::here("data"),
recurse = TRUE,
regexp = "questionnaire.csv")
quests <- map_df(qpaths, rio::import, .id = "fname") %>%
mutate(year = str_extract(fname, pattern = "\\d{4}_\\d{4}")) %>%
select(year, everything(), -fname)
demos$SEQN[1:100] == quests$SEQN[1:100]
df <- left_join(demos, quests) %>%
nest_by(year)
df
bb <- df$data[[4]]
sum(is.na(bb$PAQ677))
sum(is.na(bb$PAQ677=8))
sum(is.na(bb$PAQ678))
length(bb$PAQ678) - sum(is.na(bb$PAQ678))
length(bb$PAQ677) - sum(is.na(bb$PAQ677))
df
df
rm(list = ls())
library(distill)
getwd
getwd()
rename_post_dir("_posts/data-cleaning-and-purrr-or-shiny")
library(tidyverse)
datpath <- here::here("data")
fnames <- list.files(datpath)
pathnames <- str_c(datpath, fnames, sep = "/")
dfs <- map(pathnames, rio::import)
names(dfs) <- fnames
View(dfs)
View(dfs)
datpath <- here::here("data")
fnames <- list.files(datpath)
pathnames <- str_c(datpath, fnames, sep = "/")
fnames %>%
str_sub("DEMO")
fnames %>%
str_subset("DEMO")
rio::import(here::here("data",fnames[1]))
fnames <- list.files(here::here("data"))
fnames
fnames %>%
str_subset("DEMO")
demos <- fnames %>%
str_subset("DEMO")
demos <- fnames %>%
str_subset("DEMO") %>%
map_dfr(~{
rio::import(here::here("data", .x))
})
View(demos)
demos <- fnames %>%
str_subset("DEMO") %>%
map_dfr(~{
rio::import(here::here("data", .x))
}, .id = "filename")
View(demos)
library(fs)
dir_ls(here::here("data", "DEMO"))
dir_ls(here::here("data"))
dir_ls(here::here("data")) %>%
str_subset("DEMO")
dir_ls(here::here("data"), glob = "DEMO")
dir_ls(here::here("data"), glob = "*DEMO")
?dir_ls
dir_ls(here::here("data"), glob = "*DEMO*")
dir_ls(here::here("data"), "DEMO")
dir_ls(here::here("data"), regexp = "DEMO")
demos <- dir_ls(here::here("data"), regexp = "DEMO") %>%
map(rio::import)
fnames <- dir_ls(here::here("data"),
regexp = "DEMO")
fnames <-
demos <- dir_ls(here::here("data"),
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file")
demos <- dir_ls(here::here("data"),
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file")
View(demos)
aa <- demos$file[1]
aa
str_replace(aa, pattern = "\\d{4}_\\d{4}")
str_replace(aa, "\\d{4}_\\d{4}")
str_replace_all(aa, "\\d{4}_\\d{4}")
str_replace_all(aa, replacement = "\\d{4}_\\d{4}")
str_replace_all(aa, pattern = "\\d{4}_\\d{4}", "\\1")
str_replace(aa, pattern = "\\d{4}_\\d{4}", "\\1")
str_subset(aa, "\\d{4}_\\d{4}")
?str_replace_all
aa
str_subset(aa, pattern = "\\d{4}-\\d{4}")
?str_extract(aa, pattern = "\\d{4}-\\d{4}")
str_extract(aa, pattern = "\\d{4}-\\d{4}")
dir_ls(here::here("data"),
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}_\\d{4}"))
demos <- dir_ls(here::here("data"),
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}"))
View(demos)
demos <- dir_ls(here::here("data"),
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}")) %>%
select(-file, year, SEQN,
RIAGENDR, RIDAGEYR, RIDRETH3,
DMDEDUC2, DMDEDUC3, INDHHIN2)
demos <- dir_ls(here::here("data"),
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}")) %>%
select(year, SEQN,
RIAGENDR, RIDAGEYR, RIDRETH3,
DMDEDUC2, DMDEDUC3, INDHHIN2)
View(demos)
demos <- dir_ls(here::here("data"),
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}")) %>%
select(year, SEQN,
RIAGENDR, RIDAGEYR, RIDRETH1,
DMDEDUC2, DMDEDUC3, INDHHIN2)
View(demos)
demos <- dir_ls(here::here("data"),
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}")) %>%
select(year, SEQN,
RIAGENDR, RIDAGEYR, RIDRETH1,
DMDEDUC2, DMDEDUC3, INDHHIN2, INDHHINC)
NA + 2
demos <- dir_ls(here::here("data"),
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}")) %>%
select(year, SEQN, RIDAGEYR, RIAGENDR,
RIDRETH1, DMDEDUC2, DMDEDUC3)
View(demos)
names(demos)[2:] <- c("id","age","gender","race_ethnicity","educ_adult","educ_child")
names(demos)[2:end] <- c("id","age","gender","race_ethnicity","educ_adult","educ_child")
names(demos) <- c("year", "id","age","gender","race_ethnicity","educ_adult","educ_child")
View(demos)
demos <- dir_ls(here::here("data"),
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}")) %>%
select(year, SEQN, RIDAGEYR, RIAGENDR,
RIDRETH1, DMDEDUC2, DMDEDUC3)
fsq <- dir_ls(here::here("data"),
regexp = "FSQ") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}")) %>%
select(year, SEQN, RIDAGEYR, RIAGENDR,
RIDRETH1, DMDEDUC2, DMDEDUC3)
fsq <- dir_ls(here::here("data"),
regexp = "FSQ") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}"))
View(fsq)
names(demos) <- c("year", "id","age","gender",
"race_ethnic","educ_adult","educ_child")
View(demos)
fsq <- dir_ls(here::here("data"),
regexp = "FSQ") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}"),
hh_food_secure = ifelse(year == ("1999-2000" | "2001-2002"),
HHfdec, FSDHH)) %>%
select(year, SEQN, hh_food_secure)
fsq <- dir_ls(here::here("data"),
regexp = "FSQ") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}"),
hh_food_secure = ifelse(year == "1999-2000" | year == "2001-2002",
HHfdec, FSDHH)) %>%
select(year, SEQN, hh_food_secure)
fsq <- dir_ls(here::here("data"),
regexp = "FSQ") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}"),
hh_food_secure = ifelse(year == "1999-2000" | year == "2001-2002",
HHfdsec, FSDHH)) %>%
select(year, SEQN, hh_food_secure)
View(fsq)
fsq <- dir_ls(here::here("data"),
regexp = "FSQ") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}"),
hh_food_secure = ifelse(year == "1999-2000" | year == "2001-2002",
HHFDSEC, FSDHH)) %>%
select(year, SEQN, hh_food_secure)
View(fsq)
names(fsq)[2] <- "id"
View(fsq)
df <- left_join(demos, fsq)
View(df)
rootpath <- here::here("data")
rootpath
demos <- dir_ls(rootpath,
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}")) %>%
select(year, SEQN, RIDAGEYR, RIAGENDR,
RIDRETH1, DMDEDUC2, DMDEDUC3)
names(demos) <- c("year", "id","age","gender",
"race_ethnic","educ_adult","educ_child")
fsq <- dir_ls(rootpath,
regexp = "FSQ") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}"),
hh_food_secure = ifelse(year == "1999-2000" | year == "2001-2002",
HHFDSEC, FSDHH)) %>%
select(year, SEQN, hh_food_secure)
names(fsq)[2] <- "id"
df <- left_join(demos, fsq)
rootpath
df %>% nest_by(year)
write_csv(df, str_c(rootpath,"/nhanes_1999-2016"))
write_csv(df, str_c(rootpath,"/nhanes_1999-2016.csv"))
library(distill)
rename_post_dir("_posts/data-cleaning-and-purrr-or-shiny/")
library(tidyverse)
library(tidyverse)
library(fs)
rootpath <- here::here("data")
demos <- dir_ls(rootpath,
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}")) %>%
select(year, SEQN, RIDAGEYR, RIAGENDR,
RIDRETH1, DMDEDUC2, DMDEDUC3)
demos <- dir_ls(rootpath,
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}")) %>%
select(year, SEQN, RIDAGEYR, RIAGENDR,
RIDRETH1, DMDEDUC2, DMDEDUC3)
names(demos) <- c("year", "id","age","gender",
"race_ethnic","educ_adult","educ_child")
fsq <- dir_ls(rootpath,
regexp = "FSQ") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}"),
hh_food_secure = ifelse(year == "1999-2000" | year == "2001-2002",
HHFDSEC, FSDHH)) %>%
select(year, SEQN, hh_food_secure)
names(fsq)[2] <- "id"
df <- left_join(demos, fsq)
write_csv(df, str_c(rootpath,"/nhanes_1999-2016.csv"))
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(fs)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
fs::dir_ls(rootpath,
regexp = "DEMO")
rootpath <- here::here("data")
fs::dir_ls(rootpath)
(fnames <- fs::dir_ls(rootpath))
(fnames <- fs::dir_ls(rootpath))
fnames <- fs::dir_ls(rootpath)
str(fnames)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(fs)
(rootpath <- here::here("data"))
(fnames <- fs::dir_ls(rootpath))
fnames <- fs::dir_ls(rootpath)
paged_table(fnames, options = list(rows.print = 10))
library(rmarkdown)
paged_table(fnames, options = list(rows.print = 10))
head(fnames)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(fs)
names(head(fnames))
demo_paths <- dir_ls(rootpath, regexp = "DEMO")
demopaths
demo_paths
fsq_paths <- dir_ls(rootpath, regexp = "FSQ")
fsq_paths
demos_list <- map(demo_paths, rio::import)
str(demos_list)
demos <- map_df(demo_paths, rio::import, .id = "file")
demos <- map_df(demo_paths, rio::import, .id = "file")
fsq <- map_df(fsq_paths, rio::import, .id = "file")
head(demos$file)
demos %>%
select(SEQN, file) %>%
head()
demos %>%
select(1:5, file) %>%
head()
demos %>%
select(1:5) %>%
head()
demos %>%
select(1:4) %>%
head()
fsq %>%
select(1:4) %>%
head
fsq_list <- map(demo_paths, rio::import)
View(fsq_list)
View(demos_list)
?map
demos_list_clean <- map2(demo_paths, demos_list, ~{
.y %>%
mutate(year = str_extract(.x, "\\d{4}-\\d{4}"))
# extracts the pattern that has: 4 digits-4 digits
})
View(demos_list_clean)
demos_list_clean <- map(demos_list_clean, ~{
.x <- .x %>%
select(year, SEQN, RIDAGEYR, RIAGENDR,
RIDRETH1, DMDEDUC2, DMDEDUC3)
names(.x) <- c("year", "id","age","gender",
"race_ethnic","educ_adult","educ_child")
return(.x)
})
View(demos_list_clean)
levels(factor(demos_list_clean[[1]]$gender))
head(demos_list_clean[[1]]$race_ethnic)
demos_list_clean <- map(demos_list_clean, ~{
.x %>%
mutate(gender = factor(gender, labels = c("male","female")),
race_ethnic = factor(race_ethnic, labels = c("mexican-american",
"other-hispanic",
"non-hispanic-white",
"non-hispanic-black",
"other-race")))
})
View(demos_list_clean)
head(demos_list_clean[[1]]$race_ethnic)
paged_table(head(demos_list_clean))
head(demos_list_clean[[1]])
demos_list_clean <- map2(demo_paths, demos_list, ~{
.y %>%
mutate(year = str_extract(.x, "\\d{4}-\\d{4}"))
# extracts the pattern that has: 4 digits-4 digits
})
head(demos_list_clean[[1]])
head(demos_list_clean["year"])
head(demos_list_clean[year])
head(demos_list_clean[[1]][year])
head(demos_list_clean[[1]]["year"])
demos_list_clean <- map2(demos_paths, demos_list, ~{
.y <- .y %>%
mutate(year = str_extract(.x, "\\d{4}-\\d{4}"),
RIAGENDR = factor(RIAGENDR, labels = c("male","female")),
RIDRETH1 = factor(RIDRETH1, labels = c("mexican-american",
"other-hispanic",
"non-hispanic-white",
"non-hispanic-black",
"other-race"))) %>%
select(year, SEQN, RIDAGEYR, RIAGENDR,
RIDRETH1, DMDEDUC2, DMDEDUC3)
names(.y) <- c("year", "id","age","gender",
"race_ethnic","educ_adult","educ_child")
return(.y)
})
demos_list_clean <- map2(demo_paths, demos_list, ~{
.y <- .y %>%
mutate(year = str_extract(.x, "\\d{4}-\\d{4}"),
RIAGENDR = factor(RIAGENDR, labels = c("male","female")),
RIDRETH1 = factor(RIDRETH1, labels = c("mexican-american",
"other-hispanic",
"non-hispanic-white",
"non-hispanic-black",
"other-race"))) %>%
select(year, SEQN, RIDAGEYR, RIAGENDR,
RIDRETH1, DMDEDUC2, DMDEDUC3)
names(.y) <- c("year", "id","age","gender",
"race_ethnic","educ_adult","educ_child")
return(.y)
})
View(demos_list_clean)
demos <- dir_ls(rootpath,
regexp = "DEMO") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}"),
RIAGENDR = factor(RIAGENDR, labels = c("male","female")),
RIDRETH1 = factor(RIDRETH1, labels = c("mexican-american",
"other-hispanic",
"non-hispanic-white",
"non-hispanic-black",
"other-race"))) %>%
select(year, SEQN, RIDAGEYR, RIAGENDR,
RIDRETH1, DMDEDUC2, DMDEDUC3)
names(demos) <- c("year", "id","age","gender",
"race_ethnic","educ_adult","educ_child")
fsq <- dir_ls(rootpath,
regexp = "FSQ") %>%
map_dfr(rio::import, .id = "file") %>%
mutate(year = str_extract(file, "\\d{4}-\\d{4}"),
hh_food_secure = ifelse(year == "1999-2000" | year == "2001-2002",
HHFDSEC, FSDHH)) %>%
select(year, SEQN, hh_food_secure)
names(fsq)[2] <- "id"
df <- left_join(demos, fsq)
head(df)
write_csv(df, str_c(rootpath,"/nhanes_1999-2016.csv"))
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(fs)
str(demos_list_clean)
(rootpath <- here::here("data"))
fnames <- fs::dir_ls(rootpath)
head(fnames)
names(head(fnames))
demo_paths <- dir_ls(rootpath, regexp = "DEMO")
fsq_paths <- dir_ls(rootpath, regexp = "FSQ")
demo_paths <- dir_ls(rootpath, regexp = "DEMO")
fsq_paths <- dir_ls(rootpath, regexp = "FSQ")
demos_list <- map(demo_paths, rio::import)
demos_list <- map(demo_paths, rio::import)
fsq_list <- map(demo_paths, rio::import)
demos <- map_df(demo_paths, rio::import, .id = "file")
demos %>%
select(1:4) %>%
kable(head())
library(rmarkdown)
demos %>%
select(1:4) %>%
kable(head())
library(knitr)
demos %>%
select(1:4) %>%
kable(head())
kable(head(demos[1:4,:]))
kable(head(demos[1:4,]))
fsq <- map_df(fsq_paths, rio::import, .id = "file")
fsq <- map_df(fsq_paths, rio::import, .id = "file")
kable(head(fsq[1:4,]))
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(fs)
library(knitr)
kable(head(demos[,1:4]))
demos_list_clean <- map2(demo_paths, demos_list, ~{
.y <- .y %>%
mutate(year = str_extract(.x, "\\d{4}-\\d{4}"),
RIAGENDR = factor(RIAGENDR, labels = c("male","female")),
RIDRETH1 = factor(RIDRETH1, labels = c("mexican-american",
"other-hispanic",
"non-hispanic-white",
"non-hispanic-black",
"other-race"))) %>%
select(year, SEQN, RIDAGEYR, RIAGENDR,
RIDRETH1, DMDEDUC2, DMDEDUC3)
names(.y) <- c("year", "id","age","gender",
"race_ethnic","educ_adult","educ_child")
return(.y)
})
str(demos_list_clean[[1:3]])
str(demos_list_clean[1:3])
