data
fi <- import(here("data", "nhanes_1999-2016.csv"))
# Chunk 1: setup
library(tidyverse)
library(repurrrsive)
library(rio)
library(here)
library(glue)
fi <- import(here("data", "nhanes_1999-2016.csv"))
fi_factor <- fi %>%
mutate(security = as_factor(hh_food_secure)) %>%
mutate(security = case_when(
security == "1" ~ "full food security",
security == "2" ~ "marginal food security",
security == "3" ~ "low food security",
security == "4" ~ "very low food security")) %>%
filter(security != is.na(security))
fi_grouped_lm <- fi_grouped %>%
mutate(m1 = map(data, ~lm(security ~ age, data = .x)),
coefs = map(m1, coefficients),
intercept = map_dbl(coefs, 1),
slope = map_dbl(coefs, 2)) %>%
unnest(data) %>%
dplyr::select(year, security, intercept, slope)
fi_factor_lm <- fi_factor %>%
mutate(m1 = map(data, ~lm(security ~ age, data = .x)),
coefs = map(m1, coefficients),
intercept = map_dbl(coefs, 1),
slope = map_dbl(coefs, 2)) %>%
unnest(data) %>%
dplyr::select(year, security, intercept, slope)
fi_grouped <- fi_factor %>%
group_by(year, security) %>%
nest()
fi_grouped_lm <- fi_grouped %>%
mutate(m1 = map(data, ~lm(security ~ age, data = .x)),
coefs = map(m1, coefficients),
intercept = map_dbl(coefs, 1),
slope = map_dbl(coefs, 2)) %>%
unnest(data) %>%
dplyr::select(year, security, intercept, slope)
fi_grouped_lm <- fi_grouped %>%
mutate(m1 = map(data, ~lm(security ~ age, data = .x)),
coefs = map(m1, coefficients),
intercept = map_dbl(coefs, 1),
slope = map_dbl(coefs, 2)) %>%
unnest(data) %>%
dplyr::select(year, security, intercept, slope)
fi_grouped_lm <- fi_grouped %>%
mutate(m1 = map(data, ~lm(security ~ age, data = .x)),
coefs = map(m1, coefficients),
intercept = map_dbl(coefs, 1)
)
fi_grouped_lm <- fi_grouped %>%
mutate(m1 = map(data, ~lm(security ~ age, data = .x)),
coefs = map(m1, coefficients)
)
View(fi_grouped)
fi_factor <- fi %>%
mutate(security = as_factor(hh_food_secure))
%>%
filter(security != is.na(security))
fi_factor <- fi %>%
mutate(security = as_factor(hh_food_secure))
fi_factor <- fi %>%
filter(security != is.na(security))
View(fi_factor)
fi_factor <- fi_factor %>%
+ filter(security != is.na(security))
fi_factor <- fi_factor %>%
filter(security != is.na(security))
fi_factor_small <- fi_factor %>%
dplyr::select(year, age, security)
View(fi_factor_small)
fi_grouped <- fi_factor_small %>%
group_by(year, security) %>%
nest()
View(fi_grouped)
View(fi_grouped[[3]][[1]])
fi_grouped_lm <- fi_factor_small %>%
group_by(year) %>%
mutate(m1 = map(data, ~lm(security ~ age, data = .x)),
coefs = map(m1, coefficients),
intercept = map_dbl(coefs, 1),
slope = map_dbl(coefs, 2)) %>%
unnest(data) %>%
dplyr::select(year, security, intercept, slope)
fi_factor <- fi %>%
mutate(security = as_factor(hh_food_secure)) %>%
mutate(security = case_when(
security == "1" ~ "full food security",
security == "2" ~ "marginal food security",
security == "3" ~ "low food security",
security == "4" ~ "very low food security")) %>%
filter(security != is.na(security)) %>%
dplyr::select(year, age, security)
fi_factor <- fi %>%
mutate(security = as_factor(hh_food_secure)) %>%
mutate(security = case_when(
security == "1" ~ "full food security",
security == "2" ~ "marginal food security",
security == "3" ~ "low food security",
security == "4" ~ "very low food security")) %>%
filter(security != is.na(security)) %>%
dplyr::select(year, age, security, id)
fi_factor <- fi %>%
mutate(security = as_factor(hh_food_secure)) %>%
mutate(security = case_when(
security == "1" ~ "full food security",
security == "2" ~ "marginal food security",
security == "3" ~ "low food security",
security == "4" ~ "very low food security")) %>%
filter(security != is.na(security)) %>%
dplyr::select(year, id, age, security)
fi_grouped <- fi_factor_small %>%
group_by(year, security) %>%
nest()
fi_grouped <- fi_factor %>%
group_by(year, security) %>%
nest()
View(fi_grouped)
View(fi_grouped[[3]][[1]])
fi_grouped <- fi_factor %>%
group_by(year) %>%
nest()
View(fi_grouped[[2]][[1]])
fi_grouped_lm <- fi_factor_small %>%
group_by(year) %>%
mutate(m1 = map(data, ~lm(security ~ age, data = .x)),
coefs = map(m1, coefficients),
intercept = map_dbl(coefs, 1),
slope = map_dbl(coefs, 2)) %>%
unnest(data) %>%
dplyr::select(year, security, intercept, slope)
View(fi_grouped[[2]][[1]])
fi_factor <- fi %>%
filter(hh_food_secure != is.na(hh_food_secure)) %>%
dplyr::select(year, id, age, hh_food_secure)
fi_grouped <- fi_factor %>%
group_by(year) %>%
nest()
fi_grouped_lm <- fi_factor_small %>%
group_by(year) %>%
mutate(m1 = map(data, ~lm(hh_food_secure ~ age, data = .x)),
coefs = map(m1, coefficients),
intercept = map_dbl(coefs, 1),
slope = map_dbl(coefs, 2)) %>%
unnest(data) %>%
dplyr::select(year, security, intercept, slope)
View(fi_grouped[[2]][[1]])
View(fi)
fi_numeric <- fi %>%
mutate(security = as.numeric(hh_food_secure)) %>%
filter(security != is.na(security))
View(fi_numeric)
View(fi)
library(tidyverse)
library(repurrrsive)
library(rio)
library(here)
library(glue)
fi <- import(here("data", "nhanes_1999-2016.csv"))
fi_factor <- fi %>%
mutate(security = as_factor(hh_food_secure)) %>%
mutate(security = case_when(
security == "1" ~ "full food security",
security == "2" ~ "marginal food security",
security == "3" ~ "low food security",
security == "4" ~ "very low food security")) %>%
filter(security != is.na(security))
fi_grouped <- fi_factor %>%
group_by(year, security) %>%
nest()
str(educ_adult)
str(fi_grouped)
fi_factor <- fi %>%
mutate(security = as_factor(hh_food_secure)) %>%
mutate(security = case_when(
security == "1" ~ "full food security",
security == "2" ~ "marginal food security",
security == "3" ~ "low food security",
security == "4" ~ "very low food security")) %>%
filter(security != is.na(security),
educ_adult != is.na(educ_adult))
View(fi_factor)
fi_grouped_lm <- fi_grouped %>%
mutate(m1 = map(data, ~lm(percent_insecurity ~ educ_adult, data = .x)),
coefs = map(m1, coefficients),
intercept = map_dbl(coefs, 1),
slope = map_dbl(coefs, 2)) %>%
unnest(data) %>%
dplyr::select(year, security, intercept, slope, percent_insecurity)
fi_factor <- fi_factor %>%
add_count(year, name = "pop") %>%
add_count(year, security, name = "ct") %>%
dplyr::select(year, security, age, pop, ct) %>%
mutate(pop = as.numeric(pop),
ct = as.numeric(ct),
percent_insecurity = ct/pop)
fi_factor <- fi_factor %>%
add_count(year, name = "pop") %>%
add_count(year, security, name = "ct") %>%
dplyr::select(year, security, educ_adult, pop, ct) %>%
mutate(pop = as.numeric(pop),
ct = as.numeric(ct),
percent_insecurity = ct/pop)
fi_grouped <- fi_factor %>%
group_by(year, security) %>%
nest()
fi_factor <- fi %>%
mutate(security = as_factor(hh_food_secure)) %>%
mutate(security = case_when(
security == "1" ~ "full food security",
security == "2" ~ "marginal food security",
security == "3" ~ "low food security",
security == "4" ~ "very low food security")) %>%
filter(security != is.na(security),
educ_adult != is.na(educ_adult))
```{r}
fi_grouped <- fi_factor %>%
group_by(year, security) %>%
nest()
fi_factor <- fi_factor %>%
add_count(year, name = "pop") %>%
add_count(year, security, name = "ct") %>%
dplyr::select(year, security, educ_adult, pop, ct) %>%
mutate(pop = as.numeric(pop),
ct = as.numeric(ct),
percent_insecurity = ct/pop)
```{r}
fi_grouped_lm <- fi_grouped %>%
mutate(m1 = map(data, ~lm(percent_insecurity ~ educ_adult, data = .x)),
coefs = map(m1, coefficients),
intercept = map_dbl(coefs, 1),
slope = map_dbl(coefs, 2)) %>%
unnest(data) %>%
dplyr::select(year, security, intercept, slope, percent_insecurity)
fi_factor_lm <- fi_factor %>%
mutate(m1 = map(data, ~lm(percent_insecurity ~ educ_adult, data = .x)),
coefs = map(m1, coefficients),
intercept = map_dbl(coefs, 1),
slope = map_dbl(coefs, 2)) %>%
unnest(data) %>%
dplyr::select(year, security, intercept, slope, percent_insecurity)
fi_factor_lm <- fi_factor %>%
group_by(year) %>%
nest() %>%
mutate(m1 = map(data, ~lm(percent_insecurity ~ educ_adult, data = .x)),
coefs = map(m1, coefficients),
intercept = map_dbl(coefs, 1),
slope = map_dbl(coefs, 2)) %>%
unnest(data) %>%
dplyr::select(year, security, intercept, slope, percent_insecurity)
View(fi_factor_lm)
fi_factor_lm <- fi_factor %>%
group_by(year, security) %>%
nest() %>%
mutate(m1 = map(data, ~lm(percent_insecurity ~ educ_adult, data = .x)),
coefs = map(m1, coefficients),
intercept = map_dbl(coefs, 1),
slope = map_dbl(coefs, 2)) %>%
unnest(data) %>%
dplyr::select(year, security, intercept, slope, percent_insecurity)
fi_grouped_plots <- fi_grouped_lm %>%
group_by(security) %>%
nest() %>%
mutate(plot = pmap(list(security, data), ~{
ggplot(..2, aes(year, slope)) +
geom_point() +
geom_line() +
labs(title = glue("Slope of relation between adult education levels and {.x} by year"),
x = "Year",
y = "Slope")
})
)
fi_factor_plots <- fi_factor_lm %>%
group_by(security) %>%
nest() %>%
mutate(plot = pmap(list(security, data), ~{
ggplot(..2, aes(year, slope)) +
geom_point() +
geom_line() +
labs(title = glue("Slope of relation between adult education levels and {.x} by year"),
x = "Year",
y = "Slope")
})
)
fi_factor_plots$plot[[2]]
food_security_groups <- str_replace_all(tolower(fi_factor_plots$security), " ", "-")
paths <- here::here("plots", "slope_plots", glue("age_{food_security_groups}.png"))
walk2(paths, fi_grouped_plots$plot, ggsave,
width = 9.5,
height = 6.5,
dpi = 500)
walk2(paths, fi_factor_plots$plot, ggsave,
width = 9.5,
height = 6.5,
dpi = 500)
Zhang, M. (2003). Links between school absenteeism and child poverty. Pastoral Care in Education, 21, 10-17. doi:10.1111/1468-0122.00249
str(fi)
fi_factor_lm <- fi_factor %>%
group_by(year, security) %>%
nest() %>%
mutate(m1 = map(data, ~lm(percent_insecurity ~ educ_adult, data = .x)),
coefs = map(m1, coefficients),
slope = map_dbl(coefs, 2)) %>%
unnest(data) %>%
dplyr::select(year, security, intercept, slope, percent_insecurity)
# Chunk 1: setup
library(tidyverse)
library(repurrrsive)
library(rio)
library(here)
library(glue)
# Chunk 2: import data
fi <- import(here("data", "nhanes_1999-2016.csv"))
# Chunk 3
fi_factor <- fi %>%
mutate(security = as_factor(hh_food_secure)) %>%
mutate(security = case_when(
security == "1" ~ "full food security",
security == "2" ~ "marginal food security",
security == "3" ~ "low food security",
security == "4" ~ "very low food security")) %>%
filter(security != is.na(security),
educ_adult != is.na(educ_adult))
# Chunk 4
fi_grouped <- fi_factor %>%
group_by(year, security) %>%
nest()
# Chunk 5
fi_factor <- fi_factor %>%
add_count(year, name = "pop") %>%
add_count(year, security, name = "ct") %>%
dplyr::select(year, security, educ_adult, pop, ct) %>%
mutate(pop = as.numeric(pop),
ct = as.numeric(ct),
percent_insecurity = ct/pop)
ggplot(..2, aes(year, slope)) +
geom_point() +
geom_line() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
labs(title = glue("Slope of relation between adult education levels and {.x} by year"),
x = "Year",
y = "Slope")
fi_plots <- fi_lm %>%
group_by(security) %>%
nest() %>%
mutate(plot = pmap(list(security, data), ~{
ggplot(..2, aes(year, slope)) +
geom_point() +
geom_line() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
labs(title = glue("Slope of relation between adult education levels and {.x} by year"),
x = "Year",
y = "Slope")
})
)
fi_lm <- fi_factor %>%
group_by(year, security) %>%
nest() %>%
mutate(m1 = map(data, ~lm(percent_insecurity ~ educ_adult, data = .x)),
coefs = map(m1, coefficients),
slope = map_dbl(coefs, 2)) %>%
unnest(data) %>%
dplyr::select(year, security, slope, percent_insecurity)
fi_plots <- fi_lm %>%
group_by(security) %>%
nest() %>%
mutate(plot = pmap(list(security, data), ~{
ggplot(..2, aes(year, slope)) +
geom_point() +
geom_line() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
labs(title = glue("Slope of relation between adult education levels and {.x} by year"),
x = "Year",
y = "Slope")
})
)
fi_plots$plot[[2]]
ggplot(..2, aes(year, slope)) +
geom_point() +
geom_line() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
theme_minimal() +
labs(title = glue("Slope of relation between adult education levels and {.x} by year"),
x = "Year",
y = "Slope")
fi_plots <- fi_lm %>%
group_by(security) %>%
nest() %>%
mutate(plot = pmap(list(security, data), ~{
ggplot(..2, aes(year, slope)) +
geom_point() +
geom_line() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
theme_minimal() +
labs(title = glue("Slope of relation between adult education levels and {.x} by year"),
x = "Year",
y = "Slope")
})
)
fi_plots$plot[[2]]
ggplot(..2, aes(year, slope)) +
geom_line() +
geom_point() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
theme_minimal() +
labs(title = glue("Slope of relation between adult education levels and {.x} by year"),
x = "Year",
y = "Slope")
fi_plots <- fi_lm %>%
group_by(security) %>%
nest() %>%
mutate(plot = pmap(list(security, data), ~{
ggplot(..2, aes(year, slope)) +
geom_line() +
geom_point() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
theme_minimal() +
labs(title = glue("Slope of relation between adult education levels and {.x} by year"),
x = "Year",
y = "Slope")
})
)
fi_plots$plot[[2]]
ggplot(..2, aes(year, slope)) +
geom_line(color = year) +
geom_point() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
theme_minimal() +
labs(title = glue("Slope of relation between adult education levels and {.x} by year"),
x = "Year",
y = "Slope")
fi_plots <- fi_lm %>%
group_by(security) %>%
nest() %>%
mutate(plot = pmap(list(security, data), ~{
ggplot(..2, aes(year, slope)) +
geom_line(color = year) +
geom_point() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
theme_minimal() +
labs(title = glue("Slope of relation between adult education levels and {.x} by year"),
x = "Year",
y = "Slope")
})
)
ggplot(..2, aes(year, slope)) +
geom_line(color = slope) +
geom_point() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
theme_minimal() +
labs(title = glue("Slope of relation between adult education levels and {.x} by year"),
x = "Year",
y = "Slope")
fi_plots <- fi_lm %>%
group_by(security) %>%
nest() %>%
mutate(plot = pmap(list(security, data), ~{
ggplot(..2, aes(year, slope)) +
geom_line(color = slope) +
geom_point() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
theme_minimal() +
labs(title = glue("Slope of relation between adult education levels and {.x} by year"),
x = "Year",
y = "Slope")
})
)
fi_plots <- fi_lm %>%
group_by(security) %>%
nest() %>%
mutate(plot = pmap(list(security, data), ~{
ggplot(..2, aes(year, slope)) +
geom_line() +
geom_point() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
theme_minimal() +
labs(title = glue("Slope of relation between adult education levels and {.x} by year"),
x = "Year",
y = "Slope")
})
)
fi_plots$plot[[2]]
fi_plots <- fi_lm %>%
group_by(security) %>%
nest() %>%
mutate(plot = pmap(list(security, data), ~{
ggplot(..2, aes(year, slope)) +
geom_point() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
theme_minimal() +
labs(title = glue("Slope of relation between adult education levels and {.x} by year"),
x = "Year",
y = "Slope")
})
)
fi_plots <- fi_lm %>%
group_by(security) %>%
nest() %>%
mutate(plot = pmap(list(security, data), ~{
ggplot(..2, aes(year, slope)) +
geom_point() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
theme_minimal() +
labs(title = glue("Slope of relation between adult education levels and {.x} by year"),
x = "Year",
y = "Slope")
})
)
fi_plots$plot[[2]]
